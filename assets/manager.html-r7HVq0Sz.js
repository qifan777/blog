const n=JSON.parse('{"key":"v-36f730ba","path":"/project/spring-ai/graph/manager.html","title":"Manager构建","lang":"zh-CN","frontmatter":{"order":5,"description":"Manager构建 Manager节点 使用easy-excel读取form13.csv文件，将数据映射成Manager对象，并保存到数据库中。 Manager和Company的关联 因为Manager和Company是多对多的关系，form13.csv相当于是中间表，通过它可以创建OWNS_STOCK_IN关系。因此下面我们遍历form13.csv，...","head":[["meta",{"property":"og:url","content":"https://mister-hope.github.io/blog/project/spring-ai/graph/manager.html"}],["meta",{"property":"og:site_name","content":"起凡Code闲聊"}],["meta",{"property":"og:title","content":"Manager构建"}],["meta",{"property":"og:description","content":"Manager构建 Manager节点 使用easy-excel读取form13.csv文件，将数据映射成Manager对象，并保存到数据库中。 Manager和Company的关联 因为Manager和Company是多对多的关系，form13.csv相当于是中间表，通过它可以创建OWNS_STOCK_IN关系。因此下面我们遍历form13.csv，..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-07-18T07:14:16.000Z"}],["meta",{"property":"article:author","content":"起凡"}],["meta",{"property":"article:modified_time","content":"2024-07-18T07:14:16.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Manager构建\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-07-18T07:14:16.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"起凡\\",\\"url\\":\\"https://www.jarcheng.top\\"}]}"]]},"headers":[{"level":2,"title":"Manager节点","slug":"manager节点","link":"#manager节点","children":[]},{"level":2,"title":"Manager和Company的关联","slug":"manager和company的关联","link":"#manager和company的关联","children":[]}],"git":{"createdTime":1721286856000,"updatedTime":1721286856000,"contributors":[{"name":"linjiacheng","email":"1507906763@qq.com","commits":1}]},"readingTime":{"minutes":1.28,"words":384},"filePathRelative":"project/spring-ai/graph/manager.md","localizedDate":"2024年7月18日","excerpt":"\\n<h2>Manager节点</h2>\\n<p>使用<code>easy-excel</code>读取<code>form13.csv</code>文件，将数据映射成<code>Manager</code>对象，并保存到数据库中。</p>\\n<div class=\\"language-java\\" data-ext=\\"java\\" data-title=\\"java\\"><pre class=\\"language-java\\"><code>    <span class=\\"token keyword\\">private</span> <span class=\\"token keyword\\">final</span> <span class=\\"token class-name\\">Neo4jClient</span> neo4jClient<span class=\\"token punctuation\\">;</span>\\n    <span class=\\"token keyword\\">private</span> <span class=\\"token keyword\\">final</span> <span class=\\"token class-name\\">ObjectMapper</span> jacksonObjectMapper<span class=\\"token punctuation\\">;</span>\\n    <span class=\\"token keyword\\">private</span> <span class=\\"token keyword\\">final</span> <span class=\\"token class-name\\">ManagerRepository</span> managerRepository<span class=\\"token punctuation\\">;</span>\\n\\n    <span class=\\"token keyword\\">public</span> <span class=\\"token class-name\\">List</span><span class=\\"token generics\\"><span class=\\"token punctuation\\">&lt;</span><span class=\\"token class-name\\">Form13</span><span class=\\"token punctuation\\">&gt;</span></span> <span class=\\"token function\\">readForm13List</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n        <span class=\\"token class-name\\">SyncReadListener</span> syncReadListener <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">SyncReadListener</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n        <span class=\\"token class-name\\">EasyExcel</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">read</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">File</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"F:\\\\\\\\workspace\\\\\\\\code\\\\\\\\learn\\\\\\\\sec-edgar-notebooks\\\\\\\\data\\\\\\\\sample\\\\\\\\form13.csv\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span> <span class=\\"token class-name\\">Form13</span><span class=\\"token punctuation\\">.</span><span class=\\"token keyword\\">class</span><span class=\\"token punctuation\\">,</span> syncReadListener<span class=\\"token punctuation\\">)</span>\\n                <span class=\\"token punctuation\\">.</span><span class=\\"token function\\">sheet</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n                <span class=\\"token punctuation\\">.</span><span class=\\"token function\\">doRead</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n        <span class=\\"token keyword\\">return</span> syncReadListener<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getList</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n                <span class=\\"token punctuation\\">.</span><span class=\\"token function\\">stream</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n                <span class=\\"token punctuation\\">.</span><span class=\\"token function\\">map</span><span class=\\"token punctuation\\">(</span>o <span class=\\"token operator\\">-&gt;</span> <span class=\\"token punctuation\\">(</span><span class=\\"token class-name\\">Form13</span><span class=\\"token punctuation\\">)</span> o<span class=\\"token punctuation\\">)</span>\\n                <span class=\\"token punctuation\\">.</span><span class=\\"token function\\">toList</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n    <span class=\\"token punctuation\\">}</span>\\n\\n    <span class=\\"token annotation punctuation\\">@PostMapping</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"nodes\\"</span><span class=\\"token punctuation\\">)</span>\\n    <span class=\\"token keyword\\">public</span> <span class=\\"token keyword\\">void</span> <span class=\\"token function\\">createNodes</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n        <span class=\\"token class-name\\">List</span><span class=\\"token generics\\"><span class=\\"token punctuation\\">&lt;</span><span class=\\"token class-name\\">Form13</span><span class=\\"token punctuation\\">&gt;</span></span> form13List <span class=\\"token operator\\">=</span> <span class=\\"token function\\">readForm13List</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n        <span class=\\"token comment\\">// 投资方可能投资了多个证券，所以会有重复的投资方记录，去重一下</span>\\n        <span class=\\"token class-name\\">List</span><span class=\\"token generics\\"><span class=\\"token punctuation\\">&lt;</span><span class=\\"token class-name\\">String</span><span class=\\"token punctuation\\">&gt;</span></span> cikList <span class=\\"token operator\\">=</span> form13List<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">stream</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">map</span><span class=\\"token punctuation\\">(</span><span class=\\"token class-name\\">Form13</span><span class=\\"token operator\\">::</span><span class=\\"token function\\">getManagerCik</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">distinct</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">toList</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n        <span class=\\"token comment\\">// 每个cik代表一个投资方，映射成Manager对象</span>\\n        <span class=\\"token class-name\\">List</span><span class=\\"token generics\\"><span class=\\"token punctuation\\">&lt;</span><span class=\\"token class-name\\">Manager</span><span class=\\"token punctuation\\">&gt;</span></span> managerList <span class=\\"token operator\\">=</span> cikList<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">stream</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">map</span><span class=\\"token punctuation\\">(</span>cik <span class=\\"token operator\\">-&gt;</span> <span class=\\"token punctuation\\">{</span>\\n            <span class=\\"token class-name\\">Form13</span> manager <span class=\\"token operator\\">=</span> form13List<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">stream</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n                    <span class=\\"token punctuation\\">.</span><span class=\\"token function\\">filter</span><span class=\\"token punctuation\\">(</span>form13 <span class=\\"token operator\\">-&gt;</span> form13<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getManagerCik</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">equals</span><span class=\\"token punctuation\\">(</span>cik<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span>\\n                    <span class=\\"token punctuation\\">.</span><span class=\\"token function\\">findFirst</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n                    <span class=\\"token punctuation\\">.</span><span class=\\"token function\\">orElseThrow</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">-&gt;</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">BusinessException</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"投资公司不存在\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n            <span class=\\"token keyword\\">return</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">Manager</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n                    <span class=\\"token punctuation\\">.</span><span class=\\"token function\\">setCik</span><span class=\\"token punctuation\\">(</span>manager<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getManagerCik</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span>\\n                    <span class=\\"token punctuation\\">.</span><span class=\\"token function\\">setName</span><span class=\\"token punctuation\\">(</span>manager<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getManagerName</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span>\\n                    <span class=\\"token punctuation\\">.</span><span class=\\"token function\\">setAddress</span><span class=\\"token punctuation\\">(</span>manager<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getManagerAddress</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n        <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">toList</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n        managerRepository<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">saveAll</span><span class=\\"token punctuation\\">(</span>managerList<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n    <span class=\\"token punctuation\\">}</span>\\n</code></pre></div>","autoDesc":true}');export{n as data};
